<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.rtlcss.com/bootstrap/v4.2.1/css/bootstrap.min.css"
    integrity="sha384-vus3nQHTD+5mpDiZ4rkEPlnkcyTP+49BhJ4wJeJunw06ZAp+wzzeBPUXr42fi8If" crossorigin="anonymous">
  <style>
    body {
      overflow: hidden;
    }

    body * {
      transition: .5s;
    }

    .app {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
      z-index: 100;
      background-color: #eee;
      display: grid;
      grid-template-columns: 7fr 3fr;
      grid-template-rows: 9fr 1fr;
    }

    .bar {
      height: 100%;
      background: #0b3a87;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .footer {
      width: 100%;
      background-color: #eb892b;
      color: white;
      text-align: center;
      grid-column-end: 3;
      grid-column-start: 1;
      cursor: pointer;
    }

    .login-input {
      border-color: #B2B2B2;
      border-width: 2px;
      border-radius: 17px;
      opacity: 90%;
      flex: 1 1 auto;
      width: 1%;
      margin-bottom: 0;
      padding: .375rem .75rem;
      border-style: solid;
    }

    .login {
      color: white;
      height: fit-content;
      text-align: center;
    }

    .tryAgain {
      background: #ABD3A4 !important;
      color: black !important;
      border-color: black;
    }

    .user_card {
      height: 90%;
      width: 320px;
      margin-top: auto;
      margin-bottom: auto;
      background: url(assets/img/2084.png);
      position: relative;
      display: flex;
      justify-content: center;
      flex-direction: column;
      padding: 10px;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      -webkit-box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      -moz-box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      border-radius: 5px;

    }

    .overlay {
      background: black;
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      z-index: -1;
      opacity: 0.2;
    }

    .brand_logo_container {
      position: absolute;
      height: 170px;
      width: 170px;
      top: -75px;
      border-radius: 50%;
      background: #eeeeee;
      padding: 10px;
      text-align: center;
    }

    .brand_logo {
      height: 150px;
      position: absolute;
      top: -22px;
    }

    .form_container {
      margin-top: 100px;
    }

    .login_btn {
      width: 100%;
      background: #0b3a87;
      color: white;
    }

    .login_btn:focus {
      box-shadow: none !important;
      outline: 0px !important;
    }

    .login_container {
      padding: 0 2rem;
    }

    .input-group-text {
      background: #0b3a87 !important;
      color: white !important;
      border: 0 !important;
      border-radius: 0.25rem 0 0 0.25rem !important;
    }

    .input_user,
    .input_pass:focus {
      box-shadow: none !important;
      outline: 0px !important;
    }

    .login_btn {
      border-radius: 20px;
    }

    .register-button {
      margin-top: 10px;
      background: rgb(0, 0, 0, 0.5);
      color: white;
      border: none;
    }

    .black {
      background-color: black;
    }

    .form {
      margin-top: 10px;
    }

    .divider {
      width: 24px;
      height: 4px;
      background: white;
      border-radius: 2px 2px 2px 2px;
      margin: 30px auto 30px auto;
    }

    .custom-checkbox .custom-control-input:checked~.custom-control-label::before {
      background-color: #0b3a87 !important;
    }

    .add-button {
      position: absolute;
      top: 1px;
      left: 1px;
    }

    #lang {
      padding: inherit;
      position: relative;
      top: 36px;
    }

    #lang>li {
      padding: .2rem 1.25rem;
    }

    .custom-checkbox {
      top: 48px;
      padding-right: 2.1rem;
    }

    .phone {
      position: relative;
      text-align: center;
      bottom: -53px;
      cursor: pointer;
    }


    @media only screen and (max-width: 600px) {
      .app {
        /*grid-template-rows: 6fr 3fr 1fr;
        grid-template-columns: auto;*/
        display: block;
      }

      .footer {
        grid-column-end: 2;
        grid-column-start: 1;
        display: none;
      }

      .bar {
        display: none;
      }

      .h-100 {
        height: 100vh !important;
      }

      .user_card {
        height: 100%;
        width: 100%;
        background-size: cover;
      }

      .container {
        padding-left: 0px;
        padding-right: 0px;
      }

      .form {
        margin: 0px;
      }

      .content {
        height: 100%;
      }
    }
  </style>
  <title>SignNow</title>
  <script src="index.js" defer></script>
  <link rel="manifest" href="manifest.webmanifest">
</head>

<body>
  <main class="mdl-layout__content mdl-color--grey-100">
    <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">

      <!-- Container for the Table of content -->
      <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
        <div class="mdl-card__supporting-text mdl-color-text--grey-600">
          <!-- div to display the generated Instance ID token -->
          <div id="token_div" style="display: none;">
            <h4>Instance ID Token</h4>
            <p id="token" style="word-break: break-all;"></p>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"
              onclick="deleteToken()">Delete Token</button>
          </div>
          <!-- div to display the UI to allow the request for permission to
               notify the user. This is shown if the app has not yet been
               granted permission to notify. -->
          <div id="permission_div" style="display: none;">
            <h4>Needs Permission</h4>
            <p id="token"></p>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"
              onclick="requestPermission()">Request Permission</button>
          </div>
          <!-- div to display messages received by this app. -->
          <div id="messages"></div>
        </div>
      </div>

    </div>
  </main>
  <div class="app">
    <div class="content">
      <div class="container h-100 form">
        <div class="d-flex justify-content-center h-100">
          <div class="user_card">
            <div class="overlay"></div>
            <div class="d-flex justify-content-center">
              <img sizes="(max-width: 1400px)" srcset="
                logo/logo200.png 200w,
                logo/logo1400.png 1400w" class="brand_logo" src="logo/logo1400.png" alt="SignNow Logo">
            </div>
            <div class="d-flex justify-content-center form_container">
              <form action="">
                <div class="input-group mb-3">
                  <div class="input-group-append">
                  </div>
                  <input type="text" id="userInput" class="login-input" value="" placeholder="username">
                </div>
                <div class="input-group mb-2">
                  <div class="input-group-append">
                  </div>
                  <input type="password" id="passInput" class="login-input" value="" placeholder="password">
                </div>
                <div class="divider"></div>
                <div class="d-flex justify-content-center mt-3 login_container">
                  <button type="button" id="log" name="button" class="btn login_btn">כניסה</button>
                </div>
              </form>
            </div>
            <div id="registration" style="text-align: center;">
              <button class="register-button" onclick="this.innerText = 'Call Tomer 0528229501'">
                הרשמה
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="bar">
      <div id="hello" class="container login">
        <h1>שלום אורח</h1>
      </div>
      <div class="card">
        <ul id="message" class="list-group list-group-flush">
          <!--<li class="list-group-item"><button class="btn login_btn black"><b>בקשת תרגום</b></button>-->
          </li>
          <li class="list-group-item">תיבת טקסט</li>
        </ul>
      </div>
    </div>
    <div id="add-button" class="footer">
      <h2>Developed By
        <picture>
          <img sizes="(max-width: 1400px) 9%, 250px" srcset="
          logo/logo200.png 200w,
          logo/logo1400.png 1400w" src="logo/logo1400.png" alt="SignNow Logo">
        </picture>
      </h2>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
  </script>
  <script src="https://cdn.rtlcss.com/bootstrap/v4.2.1/js/bootstrap.min.js"
    integrity="sha384-a9xOd0rz8w0J8zqj1qJic7GPFfyMfoiuDjC9rqXlVOcGO/dmRqzMn34gZYDTel8k" crossorigin="anonymous">
  </script>
  <script src="/__/firebase/7.13.1/firebase-app.js"></script>
  <script src="/__/firebase/7.13.1/firebase-auth.js"></script>
  <script src="/__/firebase/7.13.1/firebase-messaging.js"></script>
  <script src="/__/firebase/7.13.1/firebase-firestore.js"></script>
  <script src="/__/firebase/7.13.1/firebase-functions.js"></script>
  <script src="/__/firebase/init.js"></script>
  <script>
    firebase.signedIn = false
    firebase.auth().onAuthStateChanged(res => {
      if (res) {
        window.name = res.email.split("@")[0];
        window.uid = firebase.auth().currentUser.uid;
        document.getElementById("hello").innerHTML = "<h1>" + name + "</h1>";
        userScreen();
        firebase.signedIn = true;
      } else {
        if (firebase.signedIn == true) {
          firebase.signedIn = false;
          location.reload();
        }
      }
    })

    function userScreen() {
      document.getElementsByClassName("form_container")[0].remove();
      document.getElementById("registration").remove();
      document.getElementsByClassName("brand_logo")[0].src = "logo/logo_blue.png";
      document.getElementsByClassName("brand_logo")[0].srcset = "";
      document.getElementsByClassName("brand_logo")[0].style = "logo/logo_blue.png";
      document.getElementsByClassName("overlay")[0].remove();
      document.getElementsByClassName("user_card")[0].style = "background: white"
      document.getElementsByClassName("brand_logo")[0].style = "top: -33px"
      document.getElementsByClassName("user_card")[0].innerHTML += `
<ul id="lang" class="list-group" style="padding: inherit">
<li class="list-group-item active">ישראלית</li>
<li class="list-group-item">ישראלית - ערבית</li>
<li class="list-group-item">ישראלית - רוסית</li>
</ul>
<div class="custom-control custom-checkbox">
  <input type="checkbox" class="custom-control-input" id="customCheck1">
  <label class="custom-control-label" for="customCheck1">מעוניין בתמלול</label>
</div>
<div class="phone" onclick="ask()"">
<img src="assets/img/green_phone.svg">
</div>`
      document.getElementById("lang").onclick = function (res) {
        this.getElementsByClassName("active")[0].classList.toggle("active");
        res.target.classList.toggle("active")
      }

    }

    function ask() {
      var askreq = firebase.functions().httpsCallable('ask');
      askreq().then(function (result) {
        if (result.data) {
          console.log(result);
          document.getElementsByClassName("content")[0].innerHTML =
            '<iframe class="frame" width="100%" height="100%" src="//appr.tc/r/' + result.data +
            '" allow="geolocation; microphone; camera"></iframe>'
        } else location.reload();
      });
    }

    function bold() {
      console.log("message not sent");
      const e = document.getElementsByClassName('form_container')[0];
      e.style = `transition: .5s;
                 transform: scale(1.2)`;
      setTimeout(function () {
        e.style = `transition: 1s;
                   transform: scale(1);`
      }, 1000)
    }

    const log = document.getElementById("log");
    log.addEventListener("click",
      function () {
        firebase.auth().signInWithEmailAndPassword(document.getElementById("userInput").value, document
            .getElementById("passInput").value)
          .then(res => {
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
              deferredPrompt = null;
            });
          })
          .catch(function (error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            console.log(errorCode, errorMessage)
            log.innerText = "נסה שוב";
            log.classList.toggle("tryAgain");
          });
      }
    )

    var input = document.getElementById("passInput");
    input.addEventListener("keyup", function (event) {
      if (event.keyCode === 13) {
        event.preventDefault();
        document.getElementById("log").click();
      }
    });
  </script>
  <script>
    // [START get_messaging_object]
    // Retrieve Firebase Messaging object.
    const messaging = firebase.messaging();
    // [END get_messaging_object]
    // [START set_public_vapid_key]
    // Add the public key generated from the console here.
    messaging.usePublicVapidKey(
      'BI03FTOaYp2gq8owAed2AVzoHRddX_X6EEr_vp-sjNvHyILgvvHACN-nwRaxeiENrABOacyw_aKa7CEaWGVteyc');
    // [END set_public_vapid_key]

    // [START refresh_token]
    // Callback fired if Instance ID token is updated.
    messaging.onTokenRefresh(() => {
      messaging.getToken().then((refreshedToken) => {
        console.log('Token refreshed.');
        // Indicate that the new Instance ID token has not yet been sent to the
        // app server.
        setTokenSentToServer(false);
        // Send Instance ID token to app server.
        sendTokenToServer(refreshedToken);
        // [START_EXCLUDE]
        // Display new Instance ID token and clear UI of all previous messages.
        resetUI();
        // [END_EXCLUDE]
      }).catch((err) => {
        console.log('Unable to retrieve refreshed token ', err);
        showToken('Unable to retrieve refreshed token ', err);
      });
    });
    // [END refresh_token]

    // [START receive_message]
    // Handle incoming messages. Called when:
    // - a message is received while the app has focus
    // - the user clicks on an app notification created by a service worker
    //   `messaging.setBackgroundMessageHandler` handler.

    // [END receive_message]

    function appendMessage(message) {
      document.getElementById("message").innerHTML += ('<a href=https://appr.tc/r/' + message.data.uid +
        '><li class="list-group-item"><h3>' + message.notification.title +
        '</h3>' + message.notification.body + '</li></a>')
    }

    function resetUI() {
      messaging.getToken().then((currentToken) => {
        if (currentToken) {
          sendTokenToServer(currentToken);
        } else {
          // Show permission request.
          console.log('No Instance ID token available. Request permission to generate one.');
          // Show permission UI.
          requestPermission();
          setTokenSentToServer(false);
        }
      }).catch((err) => {
        console.log('An error occurred while retrieving token. ', err);
        setTokenSentToServer(false);
      });
      // [END get_token]
    }


    // Send the Instance ID token your application server, so that it can:
    // - send messages back to this app
    // - subscribe/unsubscribe the token from topics
    function sendTokenToServer(currentToken) {
      if (!isTokenSentToServer()) {
        console.log('Sending token to server...');
        var sendToServer = firebase.functions().httpsCallable()
        sendToServer({
          "token": currentToken,
          "role": "users"
        }).then(res => {
          if (res == true)
            setTokenSentToServer(true);
        })

      } else {
        console.log('Token already sent to server so won\'t send it again ' +
          'unless it changes');
      }

    }

    function isTokenSentToServer() {
      return window.localStorage.getItem('sentToServer') === '1';
    }

    function setTokenSentToServer(sent) {
      window.localStorage.setItem('sentToServer', sent ? '1' : '0');
    }


    function requestPermission() {
      console.log('Requesting permission...');
      // [START request_permission]
      Notification.requestPermission().then((permission) => {
        if (permission === 'granted') {
          console.log('Notification permission granted.');
          // TODO(developer): Retrieve an Instance ID token for use with FCM.
          // [START_EXCLUDE]
          // In many cases once an app has been granted notification permission,
          // it should update its UI reflecting this.
          resetUI();
          // [END_EXCLUDE]
        } else {
          console.log('Unable to get permission to notify.');
        }
      });
      // [END request_permission]
    }
    requestPermission();
    resetUI();
  </script>
</body>

</html>